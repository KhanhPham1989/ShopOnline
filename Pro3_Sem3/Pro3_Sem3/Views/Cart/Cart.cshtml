@model List<Pro3_Sem3.Models.CartItem>

<h2>GIỎ HÀNG</h2>

@if (Model.Count > 0)
{
    
    int stt = 1;
    <form action="CartPayment" method="post" enctype="multipart/form-data">
        <table class="table">

            <tr>

                <th>#</th>
                <th>ID</th>
                <th>Sản phẩm</th>
                <th>Giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
                <th></th>
            </tr>

            @foreach (var cartitem in Model)
            {

                cartitem.Total = cartitem.quantity * cartitem.product.Foodprice;
                //total += thanhtien;
                //cartitem.Total = total;

                <tr>

                    <td>@(stt++)</td>
                    <td>
                        <input hidden asp-for="@cartitem.product.Foodid" name="productid" value="@cartitem.product.Foodid" />
                        <label asp-for="@cartitem.product.Foodid" name="productid" value="@cartitem.product.Foodid" />@cartitem.product.Foodid
                    </td>

                    <td>@cartitem.product.Foodname</td>
                    <td>@cartitem.product.Foodprice</td>
                    <td><input asp-for="@cartitem.quantity" name="quantity" id="@($"quantity-{cartitem.product.Foodid}")" /></td>
                    @*<td>@(thanhtien.ToString("n0"))</td>*@
                    <td> <input readonly asp-for="@cartitem.Total" name="Total" value="@cartitem.Total" />@cartitem.Total </td>

                    <td>
                        <button class="btn btn-success updatecartitem"
                                asp-action="UpdateCart"
                                data-productid="@cartitem.product.Foodid">
                            Cập nhật
                        </button>
                        <a asp-route="removecart" asp-route-productid="@cartitem.product.Foodid"
                           class="btn btn-danger">Xóa</a>
                    </td>
                </tr>
            }
        <tr>
            <td colspan="4" class="text-right">Tổng tiền</td>
            @*<td> @cartitem.Total.ToString()</td>
            @ViewBag.sum=@total.ToString()*@
            <td></td>
        </tr>

        </table>

        <a asp-controller="Cart" asp-action="CartPayment" class="btn btn-success">Gửi đơn hàng</a>
        <a asp-action="Index2" asp-controller="Cart" class="btn btn-default">Tiep tuc mua hang</a>

    </form>

    @*@section Scripts {
          <script>
        $(document).ready(function () {
            $(".updatecartitem").click(function (event) {
                event.preventDefault();
                var productid = $(this).attr("data-productid");
                var quantity = $("#quantity-" + productid).val();
                $.ajax({
                    type: "POST",
                    url:"@Url.RouteUrl("UpdateCart")",
                    data: {
                        productid: productid,
                        quantity:quantity
                    },
                    success: function (result) {
                        window.location.href = "@Url.RouteUrl("Cart")";
                    }
                });
            });
        });
          </script>*@
    //}

}
else
{
    <p class="alert alert-danger">Giỏ hàng trống</p>
}